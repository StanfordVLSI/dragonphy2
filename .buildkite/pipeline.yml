steps:
  - command: |
      source /cad/modules/tcl/init/bash
      module load base
      module load xcelium
      conda create -p ./conda_env -m -y pip python=3.7.4
      export PATH="${PWD}/conda_env/bin:${PATH}"
      pip install -e .
      pip install pytest
      pytest tests
    label: "sim-test"

  - command: |
      export PATH="/tools/Xilinx/Vivado/2018.3/bin:/tools/Xilinx/SDK/2018.3/bin:${PATH}"
      echo $PATH
      python3.7 -m venv venv
      source venv/bin/activate
      pip install -e .
      pip install pytest
      cd emu
      ./build.sh
      pytest
      deactivate
    label: "fpga-test"
    agents:
      fpga-test: "true"
